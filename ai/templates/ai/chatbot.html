{% load static %}
{% extends "mama_ai/base.html" %}

{% block content %}
<div class="chatbot-container">
    <h1>Welcome to MaMa AI</h1>
    
    <!-- Chat display area -->
    <div class="chat-display" id="chat-display">
        <!-- Messages will be appended here dynamically -->
    </div>

    <!-- Chat input area -->
    <form id="chat-form" method="POST" action="{% url 'chat' %}">
        {% csrf_token %}
        <input type="text" id="message" name="message" placeholder="Type your message here..." required>
        <button type="submit">Send</button>
    </form>
</div>

<script>
    const chatForm = document.getElementById('chat-form');
    const chatDisplay = document.getElementById('chat-display');

    chatForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        const messageInput = document.getElementById('message');
        const userMessage = messageInput.value;

        if (userMessage.trim() === '') return;

        // Display user message
        const userMessageDiv = document.createElement('div');
        userMessageDiv.classList.add('user-message');
        userMessageDiv.innerText = "You: " + userMessage;
        chatDisplay.appendChild(userMessageDiv);
        chatDisplay.scrollTop = chatDisplay.scrollHeight;  // Auto-scroll to bottom

        messageInput.value = '';  // Clear input field

        // Fetch AI response
        const response = await fetch("{% url 'chat' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                'message': userMessage,
            }),
        });

        const data = await response.json();

        // Display AI response
        const botMessageDiv = document.createElement('div');
        botMessageDiv.classList.add('bot-message');
        botMessageDiv.innerText = "AI: " + data.message;
        chatDisplay.appendChild(botMessageDiv);
        chatDisplay.scrollTop = chatDisplay.scrollHeight;  // Auto-scroll to bottom
    });
</script>
{% endblock %}
